# STM32F103ZET6 硬件资源分析

本文档旨在分析当前工程项目所使用的STM32F103ZET6微控制器硬件资源，并列出可用于未来开发的空闲资源。

---

## 1. 已用硬件资源

下表详细列出了当前已明确配置和使用的引脚及片上外设。

| 模块 | 功能 | 使用引脚 | 使用外设/资源 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **电机控制** | 控制电机方向 | `PB13`, `PD0`, `PB14`, `PB15` | `GPIOB`, `GPIOD` | 推挽输出模式。 |
| | 控制电机速度 | `PA1` (左), `PA2` (右) | `TIM5_CH2`, `TIM5_CH3` | `TIM5` 用于产生PWM信号。 |
| **编码器** | 左轮速度反馈 | `PA6`, `PA7` | `TIM3` (编码器模式) | 上拉输入。 |
| | 右轮速度反馈 | `PC6`, `PC7` | `TIM8` (编码器模式) | 上拉输入。**注意**: `Encoder_Get_Left/Right`函数逻辑可能与初始化相反。 |
| **显示** | OLED显示屏 | `PD6` (SCL), `PD7` (SDA) | `GPIOD` | 通过GPIO模拟I2C通信。 |
| **串口通信** | `printf`调试 | `PA9` (TX), `PA10` (RX) | `USART1` | - |
| | 陀螺仪数据 | `PC10` (TX), `PC11` (RX) | `UART4`, `DMA2_CH3/5`| 使用DMA进行数据传输。 |
| | 蓝牙模块 | `PC12` (TX), `PD2` (RX) | `UART5` | - |
| **输入设备** | 按键 | `PE4`, `PA0` | `GPIOE`, `GPIOA` | 下拉输入。`PA0`同时为WKUP和ADC_IN0引脚。 |
| **输出设备** | LED指示灯 | `PB1`, `PB5` | `GPIOB` | 推挽输出。**冲突**: `led.c`中有函数试图操作`PA1`，与电机PWM冲突。 |
| | 蜂鸣器 | `PF5` | `GPIOF` | 推挽输出。 |
| **核心定时器**| 系统中断 | - | `TIM4` | 产生10ms中断，作为系统主循环。 |
| | 延时函数 | - | `SysTick` | `delay.c`模块使用。 |
| **循迹模块** | **未知** | **未知** | **未知** | **源文件 `xunji.c` 缺失，无法分析。** |

---

## 2. 空闲硬件资源

基于当前工程配置，您的STM32F103ZET6仍有大量外设处于空闲状态，可供后续功能扩展：

*   **定时器**:
    *   **高级定时器**: `TIM1`
    *   **通用定时器**: `TIM2`
    *   **基本定时器**: `TIM6`, `TIM7` (非常适合用于触发DAC或作为基础时基)

*   **通信接口**:
    *   **USART**: `USART2`, `USART3`
    *   **I2C**: `I2C1`, `I2C2` (硬件I2C，性能优于GPIO模拟)
    *   **SPI**: `SPI1`, `SPI2`, `SPI3` (可用于连接SD卡、Flash存储器、射频模块等)
    *   **CAN**: `CAN1`
    *   **USB**: 1个 `USB 2.0` 全速设备接口
    *   **SDIO**: 1个 `SDIO` 接口 (专用于SD卡高速读写)

*   **模拟外设**:
    *   **ADC (模数转换器)**: `ADC1`, `ADC2`, `ADC3` (除了被用作按键的`PA0`外，仍有超过15个通道可用)
    *   **DAC (数模转换器)**: 2个独立的DAC通道，可输出模拟电压。

*   **DMA控制器**:
    *   `DMA1` 和 `DMA2` 仍有大量未使用的通道，可配合ADC、SPI、I2C等外设，实现高效数据传输，解放CPU。

---

## 3. 总结与建议

1.  **定位未知模块**: 请务必找到 `xunji.c` 文件，分析其引脚使用，避免后续开发时产生新的硬件冲突。
2.  **解决已知冲突**: 强烈建议修正 `led.c` 中对 `PA1` 引脚的错误操作，以保证电机PWM功能的稳定性。
3.  **检查代码逻辑**: 建议复查 `Encoder.c` 中编码器读取函数的逻辑，确保速度闭环控制的数据来源是正确的。
4.  **善用硬件资源**: 在后续开发中，对于I2C、SPI等通信，建议优先使用MCU自带的硬件外设，而不是GPIO模拟，这样可以获得更高的性能和可靠性，并降低CPU占用。 